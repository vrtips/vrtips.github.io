<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><meta name=description content="VRChat avatar creation blog for tips and tricks from a simple user 'Weighting (Skinning) limits for meshes in VRChat'"><title>Weighting (Skinning) limits for meshes in VRChat | VRTips</title><meta property="og:title" content="Weighting (Skinning) limits for meshes in VRChat"><meta property="og:type" content="article"><meta property="article:published_time" content="2022-10-20"><meta property="og:url" content="https://vrtips.github.io/posts/weights/"><meta property="og:site_name" content="VRTips"><meta property="og:image" content="https://vrtips.github.io/images/thumbnail.png"><meta property="og:tags" content="avatar"><meta property="og:tags" content="weighting"><meta property="og:tags" content="skinning"><meta property="og:tags" content="assets"><link rel=icon href=/favicon.ico type=image/x-icon><link rel=stylesheet href=/vendor/bootstrap/bootstrap.min.css><link rel=stylesheet href=/vendor/magnific-popup/magnific-popup.css><link rel=stylesheet href=/vendor/wow/animate.css><link rel=stylesheet href=/css/style.css></head><body><header class=header-area><div class=container><div class=row><div class=col-12><nav class="navbar navbar-expand-lg"><a class=navbar-brand href=/><img src=/images/sesivrlogo.png alt=Logo></a>
<button class=navbar-toggler type=button data-toggle=collapse data-target=#nav aria-controls=nav aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=nav><ul class="navbar-nav ml-auto"><li class=nav-item><a class=nav-link href=/>Blog</a></li><li class=nav-item><a class=nav-link href=/categories>Categories</a></li><li class=nav-item><a class=nav-link href=/tags>Tags</a></li></ul><div id=search-wrapper><form action=https://google.com/search><input type=search placeholder=Keyword name=q class=search>
<i class="fa fa-search"></i>
<input type=hidden name=sitesearch value=https://vrtips.github.io/></form></div></div></div></nav></div></div></div></header><div class=top-area><div class="top-video top-video-small"><div id=waves class=video></div><div class=container><div class=title-message><a href=https://vrtips.github.io/posts/weights/><h1>Weighting (Skinning) limits for meshes in VRChat</h1></a></div></div></div></div><div class=container><div class="row justify-content-center"><div class="col-12 col-lg-8"><div class=post-title><a href=https://vrtips.github.io/posts/weights/><div class=post-meta><time></time></div></a></div><section class=post-content><h1 id=weighting-skinning-limits-for-meshes-in-vrchat>Weighting (Skinning) limits for meshes in VRChat</h1><p>Have you ever wondered why the new piece of clothing you just created in Blender, you worked on it for 2 weeks
and have tested the most weird positions before even exporting it, then you tested in Unity and it was still good
but when you upload it to VRChat&mldr; it&rsquo;s broken! It clips!!!! WHY!?<br>You rush towards the nearest blanket, grab your Blahaj and question your life decisions&mldr;<br>But what exactly causes this behaviour? Can you do something about it?</p><p>Well, today we&rsquo;re going to explore what&rsquo;s happening behind the scenes and why this annoying behaviour exists :D</p><h2 id=whose-fault-is-it>Whose fault is it</h2><p>Is it Blender exporting weird? But in Unity the mesh was still working perfectly fine so it can&rsquo;t be!<br>Is it VRChat&rsquo;s dev team being too lazy? Well, usually yes but no, not in this case! In fact, the answer to what&rsquo;s
going on comes right from <a href=https://docs.vrchat.com/docs/vrchat-configuration-window#graphics-quality>their documentation</a>,
even if it a indirect form&mldr;</p><p>The reason for this is that the game is compiled with a pre-set limit for &ldquo;Skin Weights&rdquo; of &ldquo;4 Bones&rdquo;
(2 for VR Low and Quest versions of the game).<br>This is done mostly because otherwise Unity would have a limit of 255 weights PER VERTEX, and for the performance
savvy people out there reading this, it would mean that FOR EACH vertex the game would have to check and
do the transformation operation 255 times!!! This is a sure way to create a crasher, either on purpose or not!<br>Imagine a very low poly mesh with 20k polygons, each polygon (unity counts tris) has 3 vertices,
20 * 3 * 255 operations = 15300000 against the current 20 * 3 * 4 = 240000 !!! That is a MASSIVE difference! (And it might be worse)</p><h2 id=one-suggested-way-to-test-this-in-blender>One suggested way to test this in Blender</h2><p>Ok so here&rsquo;s my personal solution to this, there might be better ways and you can also set these limits in Unity while
you&rsquo;re testing to also check if all is good before uploading. Of course, there might be better ways to do this, in that case
please feel free to tell me! I&rsquo;d be glad to know better or more efficient ways to weight paint things and maybe add them to this
post!<br>But without losing more time, here&rsquo;s the simple solution:</p><p>Unity strips all the extra weights except the highest 4, or by <a href=https://docs.unity3d.com/ScriptReference/ModelImporter-maxBonesPerVertex.html>their own words</a>
&ldquo;vertices with more than this number will have the lowest weighted bones discarded.&rdquo;</p><p>It also just so happen that Blender has the exact same function: &ldquo;Limit Total&rdquo;! (Yes, 4 is exactly the default, this is because this is a common value
in game engines c:)
<img src=https://i.imgur.com/tl9ePvy.png alt="Limit Total option in Blender"></p><p><strong>Warning</strong>: After you use Limit total, the weights on your mesh will NOT be normalized! You can solve this by using the &ldquo;Normalize All&rdquo; button in the same menu c:
Unity&rsquo;s would be normalizing them as well as they specifically state that <a href=https://docs.unity3d.com/ScriptReference/BoneWeight.html>The sum of all weight values must be 1</a></p><p>And yeah, that&rsquo;s it! You can test the mesh now in Blender and it should behave the same in-game AND in Unity&mldr; With a little exception&mldr;<br>Most avatar bases actually don&rsquo;t do this :P Therefore when you test this in Blender you might notice that it clips now but not in VRChat!<br>This is confusing&mldr; except that you can also do the same process to the base file as well! You don&rsquo;t really lose anything as this is what
VRChat would be doing anyways! (or you can only use that mesh to test and not to import into Unity, your choice&mldr;)</p><h2 id=references>References</h2><p>[1] <a href=https://docs.unity3d.com/ScriptReference/ModelImporter-maxBonesPerVertex.html>https://docs.unity3d.com/ScriptReference/ModelImporter-maxBonesPerVertex.html</a>
[2] <a href=https://docs.vrchat.com/docs/vrchat-configuration-window#graphics-quality>https://docs.vrchat.com/docs/vrchat-configuration-window#graphics-quality</a>
[3] <a href=https://docs.unity3d.com/ScriptReference/QualitySettings-skinWeights.html>https://docs.unity3d.com/ScriptReference/QualitySettings-skinWeights.html</a></p><h2 id=curiosities>Curiosities</h2><ul><li>Weight values are stored with a precision of <a href=https://docs.unity3d.com/ScriptReference/Mesh.SetBoneWeights.html>16-bit normalized integers</a>.
This is probably cause the total size of 4 wights is then 64 bits and the value can be fetched from memory all together to optimize cache misses c:</li></ul></section><time><i class="far fa-clock"></i>
Thursday, Oct 20, 2022 16:00</time><hr class=summary-sep><div class=recommend-articles><h3>Recommend these articles</h3><ul><li><a href=https://vrtips.github.io/posts/futureproof/ rel=prev><span>Future Proof Publish SDK Option</span></a></li></ul></div></div><div id=sidebar class="col-12 col-md-8 col-lg-4"><div class=post-sidebar-area><div id=post-toc class=sidebar-widget-area><div class=title><i class="fa fa-list"></i>
TOC</div><div class=widget-content><nav id=TableOfContents><ul><li><a href=#whose-fault-is-it>Whose fault is it</a></li><li><a href=#one-suggested-way-to-test-this-in-blender>One suggested way to test this in Blender</a></li><li><a href=#references>References</a></li><li><a href=#curiosities>Curiosities</a></li></ul></nav></div></div><div class=sidebar-widget-area><div class=title><i class="fa fa-tag"></i>
Tags</div><div class=widget-content><a href=https://vrtips.github.io/tags/avatar class="badge badge-secondary">avatar</a>
<a href=https://vrtips.github.io/tags/weighting class="badge badge-secondary">weighting</a>
<a href=https://vrtips.github.io/tags/skinning class="badge badge-secondary">skinning</a>
<a href=https://vrtips.github.io/tags/assets class="badge badge-secondary">assets</a></div></div></div></div></div></div><footer class=footer-area><div class=container><div class=row><div class="col-12 col-md-4"><div class=footer-single-widget><div class="copywrite-text mt-30"><p>Copyright &copy;
<script>document.write((new Date).getFullYear())</script>All rights reserved</p><p>Made with by Gyuha</p></div></div></div></div></div></footer><script src=/vendor/jquery-2.2.4.min.js></script>
<script src=/vendor/bootstrap/popper.min.js></script>
<script src=/vendor/bootstrap/bootstrap.min.js></script>
<script src=/vendor/native-console.js></script>
<script src=/vendor/jquery.easing.1.3.js></script>
<script src=/vendor/jquery.scrollUp.min.js></script>
<script src=/js/active.js></script>
<script src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/highlight.min.js></script>
<script>hljs.initHighlightingOnLoad()</script><script src=//cdnjs.cloudflare.com/ajax/libs/three.js/r121/three.min.js></script>
<script src=//cdn.jsdelivr.net/npm/vanta@latest/dist/vanta.net.min.js></script>
<script>$(function(){window.VANTA&&window.VANTA.NET({el:"#waves",mouseControls:!0,touchControls:!0,gyroControls:!1,minHeight:200,minWidth:200,scale:1,scaleMobile:1,color:4171007})})</script></body></html>